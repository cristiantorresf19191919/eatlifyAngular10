{"ast":null,"code":"import { EventEmitter } from \"@angular/core\";\nimport { Utilities } from \"../../Utilties\";\nimport Swal from \"sweetalert2\";\nimport { Subject } from 'rxjs';\nimport { select } from '@ngrx/store';\nimport { getRestaurantId } from 'src/app/store/reducers/restaurantReducer';\nimport { takeUntil } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/servicios/delivery.service\";\nimport * as i2 from \"src/app/servicios/productos.service\";\nimport * as i3 from \"src/app/servicios/delivery-transfer-data.service\";\nimport * as i4 from \"src/app/servicios/categorias.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@ngrx/store\";\nconst _c0 = [\"pictureContainer\"];\n\nfunction CreateProductComponent_mat_option_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 24);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const cat_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", cat_r5.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(cat_r5.name);\n  }\n}\n\nfunction CreateProductComponent_label_47_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 25);\n    i0.ɵɵelementStart(1, \"button\", 26);\n    i0.ɵɵtext(2, \"Change Image\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateProductComponent_div_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵelementStart(1, \"h1\");\n    i0.ɵɵelementStart(2, \"label\", 25);\n    i0.ɵɵelement(3, \"i\", 28);\n    i0.ɵɵtext(4, \"Upload Image\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateProductComponent_div_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 29, 30);\n  }\n}\n\nexport let CreateProductComponent = /*#__PURE__*/(() => {\n  class CreateProductComponent {\n    constructor(deliveryService, productosService, deliveryTransferService, categoriasService, router, renderer, store) {\n      this.deliveryService = deliveryService;\n      this.productosService = productosService;\n      this.deliveryTransferService = deliveryTransferService;\n      this.categoriasService = categoriasService;\n      this.router = router;\n      this.renderer = renderer;\n      this.store = store;\n      this.CerrarPopUp = new EventEmitter();\n      this.topProduct = false;\n      this.loading = false;\n      this.fileLoaded = false;\n      this.addonProduct = false;\n      this.$subscriber = new Subject();\n      this.restaurantId = \"\";\n      this.onDestroy$ = new Subject();\n      this.restaurantId$ = this.store.pipe(takeUntil(this.onDestroy$), select(getRestaurantId));\n    }\n\n    ngOnDestroy() {\n      this.onDestroy$.next();\n      this.onDestroy$.complete();\n    }\n\n    ngOnInit() {\n      this.restaurantId$.subscribe(id => this.restaurantId = id);\n      this.categoriasService.getCategories().subscribe(categories => {\n        this.categories = categories.slice();\n      }, error => {\n        console.log(error);\n      });\n    }\n\n    registrar() {\n      // TODO\n      this.loading = true; //preparando el objeto para enviar\n\n      const item = {\n        name: this.name_CreateProduct,\n        price: this.price_CreateProduct,\n        description: this.description_CreateProduct,\n        category: this.category_CreateProduct,\n        topProduct: this.topProduct,\n        addonProduct: this.addonProduct,\n        restaurant: this.restaurantId\n      }; // enviando el item a la base de datos\n\n      this.productosService.addProduct(item).subscribe(response => {\n        if (response) {\n          let id = response._id;\n          this.deliveryService.SubirFoto(this.selectedImage, id).subscribe();\n          setTimeout(() => {\n            Swal.fire(\"exito\", `el producto ${item.name} se ha agregado con exito`, \"success\");\n            this.CerrarPopUp.emit(\"\");\n            this.loading = false;\n          }, 2000);\n          this.resetForm(); // this.router.navigate(['/dashboard/parentProducts/products']);\n        }\n      }, error => {\n        Swal.fire(\"error\", `${item.name} > ${error.error.msg} `, \"warning\");\n        console.log(error);\n      });\n    }\n\n    onFileSelected(imageInput) {\n      const file = imageInput.files[0];\n      /* cargue instantaneamente la imagen que sube del input */\n\n      const fileReader = new FileReader();\n      fileReader.readAsDataURL(file);\n\n      fileReader.onload = _event => {\n        // la imagen que refresca en la vista\n        this.imgUrl = fileReader.result;\n        this.$subscriber.next(this.imgUrl);\n      };\n      /* para reutilizarla en cuando de salvar al boton y hacer el post */\n\n\n      this.selectedImage = imageInput.files[0];\n      this.fileLoaded = true;\n      console.log(\"imageInput.value\");\n      console.log(imageInput.value);\n    }\n\n    addNewCategory() {\n      Utilities.CreateCategory(this.router);\n    } //  \n    //  @ViewChild(\"pictureContainer\", { static: false })                                                   pictureContainer: ElementRef;\n\n\n    ngAfterViewInit() {\n      //Called after ngAfterContentInit when the component's view has been initialized. Applies to components only.\n      //Add 'implements AfterViewInit' to the class.\n      // cuando cambio la imagen\n      // this.$subscriber.next()\n      this.$subscriber.asObservable().subscribe(img => {\n        if (img) {\n          this.pictureContainer.nativeElement.style.backgroundImage = `url(${this.imgUrl})`;\n          this.pictureContainer.nativeElement.classList.add(\"yes-picture\");\n        }\n      });\n    }\n\n    ngAfterContentInit() {\n      //Called after ngOnInit when the component's or directive's content has been initialized.\n      //Add 'implements AfterContentInit' to the class.\n      this.$subscriber.asObservable().subscribe(img => {\n        if (img) {\n          this.pictureContainer.nativeElement.style.backgroundImage = `url(${this.imgUrl})`;\n        }\n      });\n    }\n\n    resetForm() {\n      this.name_CreateProduct = \"\";\n      this.price_CreateProduct = 0;\n      this.description_CreateProduct = \"\";\n      this.category_CreateProduct = \"\";\n      this.topProduct = false;\n      this.addonProduct = false;\n      this.selectedImage = null;\n      this.fileLoaded = false;\n      this.imgUrl = null;\n    }\n\n  }\n\n  CreateProductComponent.ɵfac = function CreateProductComponent_Factory(t) {\n    return new (t || CreateProductComponent)(i0.ɵɵdirectiveInject(i1.DeliveryService), i0.ɵɵdirectiveInject(i2.ProductosService), i0.ɵɵdirectiveInject(i3.DeliveryTransferDataService), i0.ɵɵdirectiveInject(i4.CategoriasService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i6.Store));\n  };\n\n  CreateProductComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CreateProductComponent,\n    selectors: [[\"app-create-product\"]],\n    viewQuery: function CreateProductComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.pictureContainer = _t.first);\n      }\n    },\n    outputs: {\n      CerrarPopUp: \"CerrarPopUp\"\n    },\n    decls: 54,\n    vars: 10,\n    consts: [[1, \"tp-container\"], [1, \"product-header\"], [1, \"form-body\", \"p-5\"], [1, \"card-title\"], [\"appearance\", \"outline\"], [\"matInput\", \"\", \"placeholder\", \"Product Name\", 3, \"ngModel\", \"ngModelChange\"], [\"matPrefix\", \"\"], [\"matInput\", \"\", \"placeholder\", \"Product Price\", 3, \"ngModel\", \"ngModelChange\"], [\"matInput\", \"\", \"placeholder\", \"Product Description\", 3, \"ngModel\", \"ngModelChange\"], [\"placeholder\", \"Category\", 3, \"ngModel\", \"ngModelChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"click\"], [1, \"addon-container\"], [3, \"ngModel\", \"ngModelChange\"], [1, \"addon-info\"], [1, \"column\"], [\"id\", \"imageInput\", \"type\", \"file\", \"placeholder\", \"Upload Image\", 1, \"formulario__input-product\", 2, \"visibility\", \"hidden\", \"opacity\", \"0\", 3, \"change\"], [\"imageInput\", \"\"], [\"for\", \"imageInput\", \"class\", \"d-flex-main-column\", 4, \"ngIf\"], [1, \"parent-flex\"], [\"class\", \"no-picture\", 4, \"ngIf\"], [\"id\", \"yesPicture\", 4, \"ngIf\"], [1, \"my-4\", 2, \"display\", \"flex\", \"justify-content\", \"center\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [3, \"value\"], [\"for\", \"imageInput\", 1, \"d-flex-main-column\"], [\"mat-raised-button\", \"\"], [1, \"no-picture\"], [1, \"fas\", \"fa-camera\", 2, \"font-size\", \"2rem\"], [\"id\", \"yesPicture\"], [\"pictureContainer\", \"\"]],\n    template: function CreateProductComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r7 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"h1\");\n        i0.ɵɵtext(3, \"Create Product\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 2);\n        i0.ɵɵelementStart(5, \"mat-card\", 3);\n        i0.ɵɵtext(6, \"Add Products\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"mat-form-field\", 4);\n        i0.ɵɵelementStart(8, \"mat-label\");\n        i0.ɵɵtext(9, \"Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"input\", 5);\n        i0.ɵɵlistener(\"ngModelChange\", function CreateProductComponent_Template_input_ngModelChange_10_listener($event) {\n          return ctx.name_CreateProduct = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"mat-form-field\", 4);\n        i0.ɵɵelementStart(12, \"mat-label\");\n        i0.ɵɵtext(13, \"Price\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"span\", 6);\n        i0.ɵɵtext(15, \"$\\u00A0\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"input\", 7);\n        i0.ɵɵlistener(\"ngModelChange\", function CreateProductComponent_Template_input_ngModelChange_16_listener($event) {\n          return ctx.price_CreateProduct = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"mat-form-field\", 4);\n        i0.ɵɵelementStart(18, \"mat-label\");\n        i0.ɵɵtext(19, \"Description\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"input\", 8);\n        i0.ɵɵlistener(\"ngModelChange\", function CreateProductComponent_Template_input_ngModelChange_20_listener($event) {\n          return ctx.description_CreateProduct = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"mat-form-field\");\n        i0.ɵɵelementStart(22, \"mat-select\", 9);\n        i0.ɵɵlistener(\"ngModelChange\", function CreateProductComponent_Template_mat_select_ngModelChange_22_listener($event) {\n          return ctx.category_CreateProduct = $event;\n        });\n        i0.ɵɵtemplate(23, CreateProductComponent_mat_option_23_Template, 2, 2, \"mat-option\", 10);\n        i0.ɵɵelementStart(24, \"mat-option\", 11);\n        i0.ɵɵlistener(\"click\", function CreateProductComponent_Template_mat_option_click_24_listener() {\n          return ctx.addNewCategory();\n        });\n        i0.ɵɵtext(25, \"Add new Category \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"div\", 12);\n        i0.ɵɵelementStart(27, \"div\");\n        i0.ɵɵelementStart(28, \"mat-slide-toggle\", 13);\n        i0.ɵɵlistener(\"ngModelChange\", function CreateProductComponent_Template_mat_slide_toggle_ngModelChange_28_listener($event) {\n          return ctx.topProduct = $event;\n        });\n        i0.ɵɵtext(29, \"Popular Product\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"div\", 14);\n        i0.ɵɵelementStart(31, \"p\");\n        i0.ɵɵelementStart(32, \"mat-icon\");\n        i0.ɵɵtext(33, \"help\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(34, \" Check this to prioritize this product in your app, so It will show first than others \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"div\", 12);\n        i0.ɵɵelementStart(36, \"div\");\n        i0.ɵɵelementStart(37, \"mat-slide-toggle\", 13);\n        i0.ɵɵlistener(\"ngModelChange\", function CreateProductComponent_Template_mat_slide_toggle_ngModelChange_37_listener($event) {\n          return ctx.addonProduct = $event;\n        });\n        i0.ɵɵtext(38, \"AddOn Product\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(39, \"div\", 14);\n        i0.ɵɵelementStart(40, \"p\");\n        i0.ɵɵelementStart(41, \"mat-icon\");\n        i0.ɵɵtext(42, \"help\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(43, \" Check this whether you later want this product as an addon to other products. Addon products won't be visible to the App \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(44, \"div\", 15);\n        i0.ɵɵelementStart(45, \"input\", 16, 17);\n        i0.ɵɵlistener(\"change\", function CreateProductComponent_Template_input_change_45_listener() {\n          i0.ɵɵrestoreView(_r7);\n\n          const _r1 = i0.ɵɵreference(46);\n\n          return ctx.onFileSelected(_r1);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(47, CreateProductComponent_label_47_Template, 3, 0, \"label\", 18);\n        i0.ɵɵelementStart(48, \"div\", 19);\n        i0.ɵɵtemplate(49, CreateProductComponent_div_49_Template, 5, 0, \"div\", 20);\n        i0.ɵɵtemplate(50, CreateProductComponent_div_50_Template, 2, 0, \"div\", 21);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(51, \"div\", 22);\n        i0.ɵɵelementStart(52, \"button\", 23);\n        i0.ɵɵlistener(\"click\", function CreateProductComponent_Template_button_click_52_listener() {\n          return ctx.registrar();\n        });\n        i0.ɵɵtext(53, \" Add Product \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"ngModel\", ctx.name_CreateProduct);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngModel\", ctx.price_CreateProduct);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.description_CreateProduct);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.category_CreateProduct);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngModel\", ctx.topProduct);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngModel\", ctx.addonProduct);\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"ngIf\", ctx.imgUrl);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.imgUrl);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.selectedImage);\n      }\n    },\n    styles: [\".tp-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:calc(100% - 23rem);margin-left:auto;justify-content:center}.form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;font-size:1.7rem;padding:0 3rem}@media (min-width: 550px){.form-body[_ngcontent-%COMP%]{width:80%;margin:0 auto}}.parent-flex[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.no-picture[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;border:2px dashed #1349fd;background:#333 none repeat scroll 0% 0%;flex-direction:column;align-items:center;padding:20px 0;box-sizing:border-box;width:43rem;margin:0 2rem;height:14rem}.yes-picture[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;border:2px dashed #1349fd;background:#333 none repeat scroll 0% 0%;background-size:cover;background-position:top;background-repeat:no-repeat;flex-direction:column;align-items:center;padding:20px 0;box-sizing:border-box;width:43rem;margin:0 2rem;height:19rem}.picture-container[_ngcontent-%COMP%]{width:50rem;border-radius:20%}.picture-container__picture[_ngcontent-%COMP%]{border-radius:4%;height:23rem;width:42rem;border:1px solid #3f51b5;padding:4px;max-width:42rem;max-height:23rem}.addon-container[_ngcontent-%COMP%]{display:flex;margin:2% 0;align-items:center}.addon-container[_ngcontent-%COMP%]   .addon-info[_ngcontent-%COMP%]{font-size:15px;margin-left:5%;box-shadow:10px 10px 20px #222222a2,-10px -10px 20px #3e3e3ea4;padding:10px;width:50%}\"]\n  });\n  return CreateProductComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}